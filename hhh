let STATUS = {}


const flowReservarCita = addKeyword('Hola').addAnswer('Gracias por elegirnos! Para comenzar, necesitamos algunos datos')
.addAnswer(
  'Dime tu sexo',
  {capture:true},
  async (ctx,{flowDynamic}) =>{

telefono = ctx.from
sexo = STATUS[telefono] = {...STATUS[telefono], sexo : ctx.body}                //‚û°Ô∏è Variable del STATUS
telefono = STATUS[telefono] = {...STATUS[telefono], telefono : ctx.from}        // Variable del STATUS
                                                                              // Ejemplo // NOMBRE VARIABLE = TATUS[telefono], NOMBRE VARIABLE : ctx.body




flowDynamic()
})

.addAnswer(
'Dime tu nombre',
{capture:true},
async (ctx,{flowDynamic}) =>{
   
telefono = ctx.from
nombre = STATUS[telefono] = {...STATUS[telefono], nombre : ctx.body}


flowDynamic()
})

.addAnswer(
'Dime tus apellidos',
{capture:true},
async (ctx,{flowDynamic}) =>{


telefono = ctx.from
apellidos = STATUS[telefono] = {...STATUS[telefono], apellidos : ctx.body}      //Variable del STATUS
console.log(STATUS[telefono].sexo)
flowDynamic()
})
.addAnswer('¬øQu√© edad tienes?',
{capture:true},
async (ctx,{flowDynamic}) =>{


    telefono = ctx.from
    edad = STATUS[telefono] = {...STATUS[telefono], edad : ctx.body}            //Variable del STATUS




/////////////////////       ESTA FUNCION A√ëADE UNA FILA A SHEETS    /////////////////////////
   ingresarDatos();  
   async function ingresarDatos(){
    console.log(STATUS[telefono].sexo)
    let rows = [{
   // Ejemplo: // CABECERA DE SHEET : VARIABLE        //                             ‚û°Ô∏è   Paso 3 - Aqu√≠ a√±ades las variables creadas
   
    Sexo: STATUS[telefono].sexo,    
    Nombre: STATUS[telefono].nombre,
    Apellidos: STATUS[telefono].apellidos,
    Telefono: STATUS[telefono].telefono,
    Edad: STATUS[telefono].edad
   
        }];
   


    await doc.useServiceAccountAuth({
          client_email: CREDENTIALS.client_email,
          private_key: CREDENTIALS.private_key
      });
      await doc.loadInfo();
      let sheet = doc.sheetsByIndex[0];
      for (let index = 0; index < rows.length; index++) {
          const row = rows[index];
          await sheet.addRow(row);}
}





await flowDynamic ([{body:`Perfecto ${STATUS[telefono].nombre}, espero que te haya parecido sencillo el formulario üòÅ`}])

await flowDynamic ([{body:`Perfecto , puedes concultar tus datos escribiendo "Consultar Datos"üòÅ`}])








});




//////////////////////////// FLUJO PARA CONSULTAR DATOS /////////////////////////////////////////////////////////




const flowConsultar = addKeyword('Consultar mis datos','üîç Consultar mis datos üîç')
.addAnswer(['Dame unos segundo, estoy buscando tus datos dentro del sistema... üîç'])
.addAnswer(['Seg√∫n el tel√©fono del cu√°l me estas escribiendo, tengo estos datos:'],{delay:3000}, async (ctx, {flowDynamic}) =>{
telefono = ctx.from




const consultar = await consultarDatos(telefono)




const Sexo = consultados['Sexo']                        // AQUI DECLARAMOS LAS VARIABLES CON LOS DATOS QUE NOS TRAEMOS DE LA FUNCION         VVVVVVVVV
const Nombre = consultados['Nombre']
const Apellidos = consultados['Apellidos']
const Telefono = consultados['Telefono']
const Edad = consultados['Edad']




await flowDynamic(`- *Sexo*: ${Sexo}\n- *Nombre*: ${Nombre}\n- *Apellidos*: ${Apellidos}\n- *Telefono*: ${Telefono}\n- *Edad*: ${Edad}`)








})












/////////////////////       ESTA FUNCION CONSULTA LOS DATOS DE UNA FILA !SEG√öN EL TEL√âFONO!    /////////////////////////








   async function consultarDatos(telefono){
    await doc.useServiceAccountAuth({
        client_email: CREDENTIALS.client_email,
        private_key: CREDENTIALS.private_key
    });
    await doc.loadInfo();
    let sheet = doc.sheetsByTitle['Chatboot-ss'];                        // AQU√ç DEBES PONER EL NOMBRE DE TU HOJA
   
   
   
    consultados = [];




    let rows = await sheet.getRows();
    for (let index = 0; index < rows.length; index++) {
        const row = rows[index];
        if (row.Telefono === telefono) {
           
            consultados['Sexo'] = row.Sexo                      // AQU√ç LE PEDIMOS A LA FUNCION QUE CONSULTE LOS DATOS QUE QUEREMOS CONSULTAR EJEMPLO:
            consultados['Nombre'] = row.Nombre        
            consultados['Apellidos'] = row.Apellidos                  // consultados['EL NOMBRE QUE QUIERAS'] = row.NOMBRE DE LA COLUMNA DE SHEET
            consultados['Telefono'] = row.Telefono
            consultados['Edad'] = row.Edad




        }
           
}
           
return consultados




};